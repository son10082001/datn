{"version":3,"file":"client.js","sources":["../../../src/performance/client.tsx"],"sourcesContent":["import { ErrorBoundaryProps, WINDOW, withErrorBoundary } from '@sentry/react';\nimport { Transaction, TransactionContext } from '@sentry/types';\nimport { logger } from '@sentry/utils';\nimport * as React from 'react';\n\nconst DEFAULT_TAGS = {\n  'routing.instrumentation': 'remix-router',\n} as const;\n\ntype Params<Key extends string = string> = {\n  readonly [key in Key]: string | undefined;\n};\n\ninterface RouteMatch<ParamKey extends string = string> {\n  params: Params<ParamKey>;\n  pathname: string;\n  id: string;\n  handle: unknown;\n}\n\ntype UseEffect = (cb: () => void, deps: unknown[]) => void;\ntype UseLocation = () => {\n  pathname: string;\n  search?: string;\n  hash?: string;\n  state?: unknown;\n  key?: unknown;\n};\ntype UseMatches = () => RouteMatch[] | null;\n\nlet activeTransaction: Transaction | undefined;\n\nlet _useEffect: UseEffect;\nlet _useLocation: UseLocation;\nlet _useMatches: UseMatches;\n\nlet _customStartTransaction: (context: TransactionContext) => Transaction | undefined;\nlet _startTransactionOnLocationChange: boolean;\n\nfunction getInitPathName(): string | undefined {\n  if (WINDOW && WINDOW.location) {\n    return WINDOW.location.pathname;\n  }\n\n  return undefined;\n}\n\n/**\n * Creates a react-router v6 instrumention for Remix applications.\n *\n * This implementation is slightly different (and simpler) from the react-router instrumentation\n * as in Remix, `useMatches` hook is available where in react-router-v6 it's not yet.\n */\nexport function remixRouterInstrumentation(useEffect: UseEffect, useLocation: UseLocation, useMatches: UseMatches) {\n  return (\n    customStartTransaction: (context: TransactionContext) => Transaction | undefined,\n    startTransactionOnPageLoad = true,\n    startTransactionOnLocationChange = true,\n  ): void => {\n    const initPathName = getInitPathName();\n    if (startTransactionOnPageLoad && initPathName) {\n      activeTransaction = customStartTransaction({\n        name: initPathName,\n        op: 'pageload',\n        tags: DEFAULT_TAGS,\n        metadata: {\n          source: 'url',\n        },\n      });\n    }\n\n    _useEffect = useEffect;\n    _useLocation = useLocation;\n    _useMatches = useMatches;\n\n    _customStartTransaction = customStartTransaction;\n    _startTransactionOnLocationChange = startTransactionOnLocationChange;\n  };\n}\n\n/**\n * Wraps a remix `root` (see: https://remix.run/docs/en/v1/guides/migrating-react-router-app#creating-the-root-route)\n * To enable pageload/navigation tracing on every route.\n * Also wraps the application with `ErrorBoundary`.\n *\n * @param OrigApp The Remix root to wrap\n * @param options The options for ErrorBoundary wrapper.\n */\nexport function withSentry<P extends Record<string, unknown>, R extends React.FC<P>>(\n  OrigApp: R,\n  options: {\n    wrapWithErrorBoundary?: boolean;\n    errorBoundaryOptions?: ErrorBoundaryProps;\n  } = {\n    wrapWithErrorBoundary: true,\n    errorBoundaryOptions: {},\n  },\n): R {\n  const SentryRoot: React.FC<P> = (props: P) => {\n    // Early return when any of the required functions is not available.\n    if (!_useEffect || !_useLocation || !_useMatches || !_customStartTransaction) {\n      __DEBUG_BUILD__ &&\n        logger.warn('Remix SDK was unable to wrap your root because of one or more missing parameters.');\n\n      // @ts-ignore Setting more specific React Component typing for `R` generic above\n      // will break advanced type inference done by react router params\n      return <OrigApp {...props} />;\n    }\n\n    let isBaseLocation: boolean = false;\n\n    const location = _useLocation();\n    const matches = _useMatches();\n\n    _useEffect(() => {\n      if (activeTransaction && matches && matches.length) {\n        activeTransaction.setName(matches[matches.length - 1].id, 'route');\n      }\n\n      isBaseLocation = true;\n    }, []);\n\n    _useEffect(() => {\n      if (isBaseLocation) {\n        if (activeTransaction) {\n          activeTransaction.finish();\n        }\n\n        return;\n      }\n\n      if (_startTransactionOnLocationChange && matches && matches.length) {\n        if (activeTransaction) {\n          activeTransaction.finish();\n        }\n\n        activeTransaction = _customStartTransaction({\n          name: matches[matches.length - 1].id,\n          op: 'navigation',\n          tags: DEFAULT_TAGS,\n          metadata: {\n            source: 'route',\n          },\n        });\n      }\n    }, [location]);\n\n    isBaseLocation = false;\n\n    // @ts-ignore Setting more specific React Component typing for `R` generic above\n    // will break advanced type inference done by react router params\n    return <OrigApp {...props} />;\n  };\n\n  if (options.wrapWithErrorBoundary) {\n    // @ts-ignore Setting more specific React Component typing for `R` generic above\n    // will break advanced type inference done by react router params\n    return withErrorBoundary(SentryRoot, options.errorBoundaryOptions);\n  }\n\n  // @ts-ignore Setting more specific React Component typing for `R` generic above\n  // will break advanced type inference done by react router params\n  return SentryRoot;\n}\n"],"names":[],"mappings":";;;;AAAA,MAAA,YAAA,GAAA,iGAAA,CAIA;AACA,MAAA,YAAA,GAAA;AACA,EAAA,yBAAA,EAAA,cAAA;AACA,CAAA,EAAA;;AAuBA,IAAA,iBAAA,CAAA;AACA;AACA,IAAA,UAAA,CAAA;AACA,IAAA,YAAA,CAAA;AACA,IAAA,WAAA,CAAA;AACA;AACA,IAAA,uBAAA,CAAA;AACA,IAAA,iCAAA,CAAA;AACA;AACA,SAAA,eAAA,GAAA;AACA,EAAA,IAAA,MAAA,IAAA,MAAA,CAAA,QAAA,EAAA;AACA,IAAA,OAAA,MAAA,CAAA,QAAA,CAAA,QAAA,CAAA;AACA,GAAA;AACA;AACA,EAAA,OAAA,SAAA,CAAA;AACA,CAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAA,0BAAA,CAAA,SAAA,EAAA,WAAA,EAAA,UAAA,EAAA;AACA,EAAA,OAAA;AACA,IAAA,sBAAA;AACA,IAAA,0BAAA,GAAA,IAAA;AACA,IAAA,gCAAA,GAAA,IAAA;AACA,OAAA;AACA,IAAA,MAAA,YAAA,GAAA,eAAA,EAAA,CAAA;AACA,IAAA,IAAA,0BAAA,IAAA,YAAA,EAAA;AACA,MAAA,iBAAA,GAAA,sBAAA,CAAA;AACA,QAAA,IAAA,EAAA,YAAA;AACA,QAAA,EAAA,EAAA,UAAA;AACA,QAAA,IAAA,EAAA,YAAA;AACA,QAAA,QAAA,EAAA;AACA,UAAA,MAAA,EAAA,KAAA;AACA,SAAA;AACA,OAAA,CAAA,CAAA;AACA,KAAA;AACA;AACA,IAAA,UAAA,GAAA,SAAA,CAAA;AACA,IAAA,YAAA,GAAA,WAAA,CAAA;AACA,IAAA,WAAA,GAAA,UAAA,CAAA;AACA;AACA,IAAA,uBAAA,GAAA,sBAAA,CAAA;AACA,IAAA,iCAAA,GAAA,gCAAA,CAAA;AACA,GAAA,CAAA;AACA,CAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAA,UAAA;AACA,EAAA,OAAA;AACA,EAAA,OAAA;;AAGA,GAAA;AACA,IAAA,qBAAA,EAAA,IAAA;AACA,IAAA,oBAAA,EAAA,EAAA;AACA,GAAA;AACA,EAAA;AACA,EAAA,MAAA,UAAA,GAAA,CAAA,KAAA,KAAA;AACA;AACA,IAAA,IAAA,CAAA,UAAA,IAAA,CAAA,YAAA,IAAA,CAAA,WAAA,IAAA,CAAA,uBAAA,EAAA;AACA,MAAA,CAAA,OAAA,gBAAA,KAAA,WAAA,IAAA,gBAAA;AACA,QAAA,MAAA,CAAA,IAAA,CAAA,mFAAA,CAAA,CAAA;AACA;AACA;AACA;AACA,MAAA,OAAA,KAAA,CAAA,aAAA,CAAA,OAAA,EAAA,EAAA,GAAA,KAAA,EAAA,MAAA,EAAA,IAAA,EAAA,QAAA,EAAA,CAAA,QAAA,EAAA,YAAA,EAAA,UAAA,EAAA,GAAA,CAAA,CAAA,EAAA,CAAA;AACA,KAAA;AACA;AACA,IAAA,IAAA,cAAA,GAAA,KAAA,CAAA;AACA;AACA,IAAA,MAAA,QAAA,GAAA,YAAA,EAAA,CAAA;AACA,IAAA,MAAA,OAAA,GAAA,WAAA,EAAA,CAAA;AACA;AACA,IAAA,UAAA,CAAA,MAAA;AACA,MAAA,IAAA,iBAAA,IAAA,OAAA,IAAA,OAAA,CAAA,MAAA,EAAA;AACA,QAAA,iBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,OAAA,CAAA,MAAA,GAAA,CAAA,CAAA,CAAA,EAAA,EAAA,OAAA,CAAA,CAAA;AACA,OAAA;AACA;AACA,MAAA,cAAA,GAAA,IAAA,CAAA;AACA,KAAA,EAAA,EAAA,CAAA,CAAA;AACA;AACA,IAAA,UAAA,CAAA,MAAA;AACA,MAAA,IAAA,cAAA,EAAA;AACA,QAAA,IAAA,iBAAA,EAAA;AACA,UAAA,iBAAA,CAAA,MAAA,EAAA,CAAA;AACA,SAAA;AACA;AACA,QAAA,OAAA;AACA,OAAA;AACA;AACA,MAAA,IAAA,iCAAA,IAAA,OAAA,IAAA,OAAA,CAAA,MAAA,EAAA;AACA,QAAA,IAAA,iBAAA,EAAA;AACA,UAAA,iBAAA,CAAA,MAAA,EAAA,CAAA;AACA,SAAA;AACA;AACA,QAAA,iBAAA,GAAA,uBAAA,CAAA;AACA,UAAA,IAAA,EAAA,OAAA,CAAA,OAAA,CAAA,MAAA,GAAA,CAAA,CAAA,CAAA,EAAA;AACA,UAAA,EAAA,EAAA,YAAA;AACA,UAAA,IAAA,EAAA,YAAA;AACA,UAAA,QAAA,EAAA;AACA,YAAA,MAAA,EAAA,OAAA;AACA,WAAA;AACA,SAAA,CAAA,CAAA;AACA,OAAA;AACA,KAAA,EAAA,CAAA,QAAA,CAAA,CAAA,CAAA;AACA;AACA,IAAA,cAAA,GAAA,KAAA,CAAA;AACA;AACA;AACA;AACA,IAAA,OAAA,KAAA,CAAA,aAAA,CAAA,OAAA,EAAA,EAAA,GAAA,KAAA,EAAA,MAAA,EAAA,IAAA,EAAA,QAAA,EAAA,CAAA,QAAA,EAAA,YAAA,EAAA,UAAA,EAAA,GAAA,CAAA,CAAA,EAAA,CAAA;AACA,GAAA,CAAA;AACA;AACA,EAAA,IAAA,OAAA,CAAA,qBAAA,EAAA;AACA;AACA;AACA,IAAA,OAAA,iBAAA,CAAA,UAAA,EAAA,OAAA,CAAA,oBAAA,CAAA,CAAA;AACA,GAAA;AACA;AACA;AACA;AACA,EAAA,OAAA,UAAA,CAAA;AACA;;;;"}